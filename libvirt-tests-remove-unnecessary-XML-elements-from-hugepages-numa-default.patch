From 1dc9941c5aa7fb921a1f868669b12108b477f572 Mon Sep 17 00:00:00 2001
Message-Id: <1dc9941c5aa7fb921a1f868669b12108b477f572@dist-git>
From: Pavel Hrdina <phrdina@redhat.com>
Date: Mon, 13 Aug 2018 18:16:07 +0200
Subject: [PATCH] tests: remove unnecessary XML elements from
 hugepages-numa-default
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Signed-off-by: Pavel Hrdina <phrdina@redhat.com>
(cherry picked from commit 335c4a5e26b23d4dcb86ede5a43c5bb8a68b604e)

Conflicts:
    tests/qemuxml2argvdata/hugepages-numa-default.args
        - missing upstream commit <caccbba64a>

Resolves: https://bugzilla.redhat.com/show_bug.cgi?id=1591235

Signed-off-by: Pavel Hrdina <phrdina@redhat.com>
Reviewed-by: JÃ¡n Tomko <jtomko@redhat.com>
---
 .../hugepages-numa-default.args               | 42 ++---------
 .../hugepages-numa-default.xml                | 74 +------------------
 tests/qemuxml2argvtest.c                      |  6 --
 3 files changed, 7 insertions(+), 115 deletions(-)

diff --git a/tests/qemuxml2argvdata/hugepages-numa-default.args b/tests/qemuxml2argvdata/hugepages-numa-default.args
index 20c7802fd8..cc2223aee1 100644
--- a/tests/qemuxml2argvdata/hugepages-numa-default.args
+++ b/tests/qemuxml2argvdata/hugepages-numa-default.args
@@ -3,7 +3,7 @@ PATH=/bin \
 HOME=/home/test \
 USER=test \
 LOGNAME=test \
-QEMU_AUDIO_DRV=spice \
+QEMU_AUDIO_DRV=none \
 /usr/bin/qemu-system-x86_64 \
 -name fedora \
 -S \
@@ -14,46 +14,14 @@ QEMU_AUDIO_DRV=spice \
 -mem-path /dev/hugepages2M/libvirt/qemu/-1-fedora \
 -numa node,nodeid=0,cpus=0-1,mem=1024 \
 -uuid 63840878-0deb-4095-97e6-fc444d9bc9fa \
+-display none \
 -no-user-config \
 -nodefaults \
 -chardev socket,id=charmonitor,path=/tmp/lib/domain--1-fedora/monitor.sock,\
 server,nowait \
 -mon chardev=charmonitor,id=monitor,mode=control \
--rtc base=utc,driftfix=slew \
--no-hpet \
+-rtc base=utc \
 -no-shutdown \
--global PIIX4_PM.disable_s3=1 \
--global PIIX4_PM.disable_s4=1 \
+-no-acpi \
 -boot c \
--device ich9-usb-ehci1,id=usb,bus=pci.0,addr=0x6.0x7 \
--device ich9-usb-uhci1,masterbus=usb.0,firstport=0,bus=pci.0,multifunction=on,\
-addr=0x6 \
--device ich9-usb-uhci2,masterbus=usb.0,firstport=2,bus=pci.0,addr=0x6.0x1 \
--device ich9-usb-uhci3,masterbus=usb.0,firstport=4,bus=pci.0,addr=0x6.0x2 \
--device virtio-serial-pci,id=virtio-serial0,bus=pci.0,addr=0x5 \
--drive file=/var/lib/libvirt/images/fedora.qcow2,format=qcow2,if=none,\
-id=drive-virtio-disk0 \
--device virtio-blk-pci,bus=pci.0,addr=0x7,drive=drive-virtio-disk0,\
-id=virtio-disk0 \
--drive if=none,id=drive-ide0-0-0,media=cdrom,readonly=on \
--device ide-drive,bus=ide.0,unit=0,drive=drive-ide0-0-0,id=ide0-0-0 \
--chardev socket,id=charchannel0,\
-path=/var/lib/libvirt/qemu/channel/target/fedora.org.qemu.guest_agent.0,server,\
-nowait \
--device virtserialport,bus=virtio-serial0.0,nr=1,chardev=charchannel0,\
-id=channel0,name=org.qemu.guest_agent.0 \
--chardev spicevmc,id=charchannel1,name=vdagent \
--device virtserialport,bus=virtio-serial0.0,nr=2,chardev=charchannel1,\
-id=channel1,name=com.redhat.spice.0 \
--device usb-tablet,id=input0,bus=usb.0,port=1 \
--spice port=5901,tls-port=5902,addr=127.0.0.1,x509-dir=/etc/pki/libvirt-spice \
--vga qxl \
--global qxl-vga.ram_size=67108864 \
--global qxl-vga.vram_size=67108864 \
--device intel-hda,id=sound0,bus=pci.0,addr=0x4 \
--device hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 \
--chardev spicevmc,id=charredir0,name=usbredir \
--device usb-redir,chardev=charredir0,id=redir0,bus=usb.0,port=2 \
--chardev spicevmc,id=charredir1,name=usbredir \
--device usb-redir,chardev=charredir1,id=redir1,bus=usb.0,port=3 \
--device virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x8
+-usb
diff --git a/tests/qemuxml2argvdata/hugepages-numa-default.xml b/tests/qemuxml2argvdata/hugepages-numa-default.xml
index d3c6308be0..6bbd80d515 100644
--- a/tests/qemuxml2argvdata/hugepages-numa-default.xml
+++ b/tests/qemuxml2argvdata/hugepages-numa-default.xml
@@ -11,90 +11,20 @@
     <type arch='x86_64' machine='pc-i440fx-2.3'>hvm</type>
     <boot dev='hd'/>
   </os>
-  <features>
-    <acpi/>
-    <apic/>
-    <pae/>
-  </features>
   <cpu>
     <numa>
       <cell id='0' cpus='0-1' memory='1048576' unit='KiB'/>
     </numa>
   </cpu>
-  <clock offset='utc'>
-    <timer name='rtc' tickpolicy='catchup'/>
-    <timer name='pit' tickpolicy='delay'/>
-    <timer name='hpet' present='no'/>
-  </clock>
   <on_poweroff>destroy</on_poweroff>
   <on_reboot>restart</on_reboot>
   <on_crash>restart</on_crash>
-  <pm>
-    <suspend-to-mem enabled='no'/>
-    <suspend-to-disk enabled='no'/>
-  </pm>
   <devices>
     <emulator>/usr/bin/qemu-system-x86_64</emulator>
-    <disk type='file' device='disk'>
-      <driver name='qemu' type='qcow2'/>
-      <source file='/var/lib/libvirt/images/fedora.qcow2'/>
-      <target dev='vda' bus='virtio'/>
-      <address type='pci' domain='0x0000' bus='0x00' slot='0x07' function='0x0'/>
-    </disk>
-    <disk type='block' device='cdrom'>
-      <driver name='qemu' type='raw'/>
-      <target dev='hda' bus='ide'/>
-      <readonly/>
-      <address type='drive' controller='0' bus='0' target='0' unit='0'/>
-    </disk>
-    <controller type='usb' index='0' model='ich9-ehci1'>
-      <address type='pci' domain='0x0000' bus='0x00' slot='0x06' function='0x7'/>
-    </controller>
-    <controller type='usb' index='0' model='ich9-uhci1'>
-      <master startport='0'/>
-      <address type='pci' domain='0x0000' bus='0x00' slot='0x06' function='0x0' multifunction='on'/>
-    </controller>
-    <controller type='usb' index='0' model='ich9-uhci2'>
-      <master startport='2'/>
-      <address type='pci' domain='0x0000' bus='0x00' slot='0x06' function='0x1'/>
-    </controller>
-    <controller type='usb' index='0' model='ich9-uhci3'>
-      <master startport='4'/>
-      <address type='pci' domain='0x0000' bus='0x00' slot='0x06' function='0x2'/>
-    </controller>
+    <controller type='usb' index='0'/>
     <controller type='pci' index='0' model='pci-root'/>
-    <controller type='ide' index='0'>
-      <address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x1'/>
-    </controller>
-    <controller type='virtio-serial' index='0'>
-      <address type='pci' domain='0x0000' bus='0x00' slot='0x05' function='0x0'/>
-    </controller>
-    <channel type='unix'>
-      <source mode='bind' path='/var/lib/libvirt/qemu/channel/target/fedora.org.qemu.guest_agent.0'/>
-      <target type='virtio' name='org.qemu.guest_agent.0'/>
-      <address type='virtio-serial' controller='0' bus='0' port='1'/>
-    </channel>
-    <channel type='spicevmc'>
-      <target type='virtio' name='com.redhat.spice.0'/>
-      <address type='virtio-serial' controller='0' bus='0' port='2'/>
-    </channel>
-    <input type='tablet' bus='usb'/>
     <input type='mouse' bus='ps2'/>
     <input type='keyboard' bus='ps2'/>
-    <graphics type='spice' autoport='yes'/>
-    <sound model='ich6'>
-      <address type='pci' domain='0x0000' bus='0x00' slot='0x04' function='0x0'/>
-    </sound>
-    <video>
-      <model type='qxl' ram='65536' vram='65536' vgamem='16384' heads='1'/>
-      <address type='pci' domain='0x0000' bus='0x00' slot='0x02' function='0x0'/>
-    </video>
-    <redirdev bus='usb' type='spicevmc'>
-    </redirdev>
-    <redirdev bus='usb' type='spicevmc'>
-    </redirdev>
-    <memballoon model='virtio'>
-      <address type='pci' domain='0x0000' bus='0x00' slot='0x08' function='0x0'/>
-    </memballoon>
+    <memballoon model='none'/>
   </devices>
 </domain>
diff --git a/tests/qemuxml2argvtest.c b/tests/qemuxml2argvtest.c
index bf3fb156a2..19fb7a0931 100644
--- a/tests/qemuxml2argvtest.c
+++ b/tests/qemuxml2argvtest.c
@@ -947,12 +947,6 @@ mymain(void)
 
     DO_TEST("hugepages-default", NONE);
     DO_TEST("hugepages-numa-default",
-            QEMU_CAPS_PIIX_DISABLE_S3, QEMU_CAPS_PIIX_DISABLE_S4,
-            QEMU_CAPS_VIRTIO_SCSI,
-            QEMU_CAPS_ICH9_USB_EHCI1,
-            QEMU_CAPS_SPICE,
-            QEMU_CAPS_DEVICE_QXL,
-            QEMU_CAPS_HDA_DUPLEX, QEMU_CAPS_USB_REDIR,
             QEMU_CAPS_OBJECT_MEMORY_FILE);
     DO_TEST("hugepages-numa-default-dimm",
             QEMU_CAPS_DEVICE_PC_DIMM,
-- 
2.18.0

